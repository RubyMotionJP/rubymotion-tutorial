
<!doctype html>
  <head>
    <title> HTTP |  RubyMotion Tutorial</title>
    <meta name="description" content="Use BubbleWrap's HTTP module to access the web with RubyMotion" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="robots" content="all" />
    <meta name="MSSmartTagsPreventParsing" content="true" />
    <meta name="author" content="Clay Allsopp" />

    <meta property="og:title" content="RubyMotion Tutorial: Write iOS apps in Ruby" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="http://tutorial.rubymotion.jp/" />
    <meta property="og:image" content="http://i.imgur.com/mndCd.png" />
    <meta property="og:site_name" content="RubyMotion Tutorial" />
    <meta property="og:description" content="Learn to write iOS apps in Ruby.">

    <meta name=viewport content="width=device-width, initial-scale=1.0,maximum-scale = 1.0">

    <link rel=stylesheet href='/css/bootstrap.min.css'>
    <link rel=stylesheet href='/css/bootstrap-responsive.min.css'>
    <link rel=stylesheet href='/css/blog/pygments.css'>
    <link rel=stylesheet href='/css/patch.css'>
    <link rel=stylesheet href='/css/chapter.css'>
    

  </head>

  <body>
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>

    <a id="fork-me" href="https://github.com/RubyMotionJP/rubymotion-tutorial" target="_blank">Fork me on GitHub</a>
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span2" id="derp">
            <nav>
            <ul class="nav nav-list">
              <li class="nav-header" id="chapter-nav-btn">
                Chapters <i class="icon-chevron-up" id="chapter-nav-chevron"></i>
              </li>
            </ul>
            <ul class="nav nav-list" id="chapter-nav">
              
                <li >
                  <a href="/0-in-motion">In Motion</a>
                </li>
              
                <li >
                  <a href="/1-hello-motion">Hello Motion</a>
                </li>
              
                <li >
                  <a href="/2-views">Views</a>
                </li>
              
                <li >
                  <a href="/3-controllers">Controllers</a>
                </li>
              
                <li >
                  <a href="/4-containers">Containers</a>
                </li>
              
                <li >
                  <a href="/5-tables">Tables</a>
                </li>
              
                <li >
                  <a href="/6-animations">Animations</a>
                </li>
              
                <li >
                  <a href="/7-models">Models</a>
                </li>
              
                <li >
                  <a href="/8-testing">Testing</a>
                </li>
              
                <li  class="active" >
                  <a href="/9-http">HTTP</a>
                </li>
              
                <li >
                  <a href="/10-api-driven-example">API Driven Example</a>
                </li>
              
            </ul>
            <ul class="nav nav-list">
              <li class="divider"></li>
              <li><a href="/">Home</a></li>
              <li><a href="https://github.com/RubyMotionJP/rubymotion-tutorial">Source</a></li>
              <li class="divider"></li>
            </ul>
          </nav>
        </div>
        <div class="span10" id="content">
          <div id="main">
            <h1 id="toc_0">An Introduction to HTTP</h1>

<p>これまで iOS 上の UI 構築について取り扱ってきました。しかしできることならサーバとデータのやりとりをするインタフェースにほとんどの時間を費やしたいことでしょう。これを行うために Apple が提供する方法は <code>NSURLConnection</code> を使うことです。これはとてもパワフルですが、HTTP リクエストを送信するためには冗長なクラスです。代わりに、<code>BubbleWrap</code> と呼ばれる最新の RubyMotion ライブラリを使う予定です。</p>

<h2 id="toc_1">BubbleWrap It Up</h2>

<p>すでに述べたように、<a href="http://bubblewrap.io/">BubbleWrap</a> は iOS SDK 用の Ruby ラッパーのコレクションです。多くの Apple の API は、コールバックが設定されたオブジェクト上の決められたメソッドを呼び出すシステムを使用しています。したがって、BubbleWrap のラッパーの多くはこれらのコールバックメソッドを <code>lambda</code> と <code>block</code> で動くようにしているだけです。例として <code>BubbleWrap::HTTP</code> ラッパーを取り上げる予定です。</p>

<p><code>Rakefile</code> に <code>require</code> を追加することを覚えておいてください。</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="vg">$:</span><span class="o">.</span><span class="n">unshift</span><span class="p">(</span><span class="s2">&quot;/Library/RubyMotion/lib&quot;</span><span class="p">)</span>
<span class="nb">require</span> <span class="s1">&#39;motion/project&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;bubble-wrap&#39;</span>

<span class="o">.</span><span class="n">.</span><span class="o">.</span>
</code></pre></div>
<p><code>BubbleWrap::HTTP</code> ライブラリでは、HTTP リクエストメソッドとしてそれぞれ <code>HTTP.get</code>, <code>HTTP.post</code>, <code>HTTP.put</code> などの機能を使えます。それぞれのメソッドは引数として URL 文字列とオプションのハッシュ、リクエストが終了したときのコールバックブロックを取ります。以下は、いくつか短いそれらのサンプルです。</p>
<div class="highlight"><pre><code class="ruby language-ruby" data-lang="ruby"><span class="ss">BubbleWrap</span><span class="p">:</span><span class="ss">:HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://google.com&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="nb">p</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">to_str</span>
<span class="k">end</span>

<span class="c1"># BW is alias for BubbleWrap</span>
<span class="ss">BW</span><span class="p">:</span><span class="ss">:HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://www.bing.com/search&quot;</span><span class="p">,</span> <span class="ss">payload</span><span class="p">:</span> <span class="p">{</span><span class="ss">q</span><span class="p">:</span> <span class="s2">&quot;some query&quot;</span><span class="p">})</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="c1"># sends request to http://www.bing.com/search?q=some+query</span>
<span class="k">end</span>

<span class="ss">BW</span><span class="p">:</span><span class="ss">:HTTP</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;https://graph.facebook.com/123123123/comments&quot;</span><span class="p">,</span> <span class="ss">payload</span><span class="p">:</span> <span class="p">{</span><span class="ss">message</span><span class="p">:</span> <span class="s2">&quot;This is a comment&quot;</span><span class="p">})</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="c1"># sends request to https://graph.facebook.com/123123123/comments</span>
  <span class="c1"># with body params `message=This is a comment`</span>
<span class="k">end</span>
</code></pre></div>
<p>かなり良さそうに見えるでしょう？リクエストにより多くの情報 (ファイル、ヘッダー、HTTP 認証) を追加することができます。私たちが遊んだ API は GET と POST を使用しただけです。(<a href="https://github.com/rubymotion/BubbleWrap/blob/master/motion/http.rb">HTTP documentation</a> で詳細をチェックできます)</p>

<p>ちょっと待って、私たちは実際に何を作るんでしょう？</p>

<p><a href="/10-api-driven-example">Get ready for an example on how to build an API-driven App!</a></p>

          </div>
          <hr />
          <h2>Like it?<small id="spread"> Spread the word</small></h2>
          <div id="social">
            <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>

            <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://tutorial.rubymotion.jp" data-text="RubyMotion Tutorial: Make iOS Apps With Ruby" data-size="large" data-related="rubymotionjp" data-count="none">Tweet</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

            <div class="fb-like" data-href="http://tutorial.rubymotion.jp/" data-send="true" data-width="450" data-show-faces="true"></div>
          </div>
          <hr />
        </div>
      </div>
    </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src='http://clayallsopp.github.com/rubymotion-tutorial/js/bootstrap.min.js' type="text/javascript"></script>
  <script src='http://clayallsopp.github.com/rubymotion-tutorial/js/chapters.js' type="text/javascript"></script>
  </body>
</html>
